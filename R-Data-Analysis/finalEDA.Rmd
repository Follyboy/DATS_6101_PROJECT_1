---
title: "finalEDA"
author: "Team 6"
date: "2022-10-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Importing all the relevant packages and libraries 

```{r results='markup'}
#install packages
#remotes::install_github("cran/DMwR")
#install.packages("moments")

#import libraries all
library(ggplot2)
library(moments)
library(dplyr)
library(DMwR)
``` 

Importing our dataset and checking summary
```{r results='markup'}
#importing brain dataset
data <- data.frame(read.csv("dataset.csv"))


#checking the structure of our dataset 
str(data)

#since ID won't be useful during prediction so removing that 
brainData <- select(data, -c('id'))

#checking top5 entries in our dataset 
head(brainData)
```

Checking the summary of our dataset
```{r results='markup'}
summary(brainData)
```

Since most of the varibales our categorical, converting them to factors
```{r results='markup'}
#Converting gender,hypertension,heart_disease,ever_married,work_type,Residence_type,smoking_status,stroke to factors
brainData$gender = factor(brainData$gender)
brainData$hypertension = factor(brainData$hypertension)
brainData$heart_disease = factor(brainData$heart_disease)
brainData$ever_married = factor(brainData$ever_married)
brainData$work_type = factor(brainData$work_type)
brainData$Residence_type = factor(brainData$Residence_type)
brainData$smoking_status = factor(brainData$smoking_status)
brainData$stroke = factor(brainData$stroke)
str(brainData)
summary(brainData)
```


*We can see missing values in bmi, smoking_status \
**Class Imbalance problem** \
we have 42617 observations for stroke = 0 and 783 observations for stroke =1 \
\ 
Cleaning the dataset


Removing missing Values for smoking status 
```{r results='markup'}
cleanData = brainData
cleanData[cleanData == ''] <- NA
nrow(cleanData)
cleanData <- subset(cleanData, !is.na(smoking_status))
nrow(cleanData)
```
Analysis for BMI NULL values.
```{r, results='markup'}
ggplot(data=brainData, aes(bmi)) +
geom_histogram(col="black",
fill="blue") +
labs(x="bmi", y="frequency") +
labs(title="plot of bmi")
```
```{r, results='markup'}
tempdf <- subset(brainData, !is.na(bmi))  # removing NA values from bmi and storing it in tempdf
density_bmi <- density(tempdf$bmi)
plot(density_bmi)    #plotting the density curve of bmi values

ggplot(data = tempdf, mapping = aes(y = bmi)) +
  geom_boxplot() + geom_boxplot( colour="black", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=2)  #plotting the boxplot for bmi values.
```
```{r, results='markup'}
skewness_value <- skewness(tempdf$bmi)
```
Skewness value: `r skewness_value`


From the density curve and skewness value, BMI is rightly skewed. So mean is not the right central tendency to fill NA values in BMI.
We will NA values in BMI using median of the data.
Note: Negative skewness value indicates left skewed and positive skewness value indicates right skewed.
The rule of thumb seems to be:

If the skewness is between -0.5 and 0.5, the data are fairly symmetrical
If the skewness is between -1 and â€“ 0.5 or between 0.5 and 1, the data are moderately skewed
If the skewness is less than -1 or greater than 1, the data are highly skewed

Replacing Missing Values for BMI with median.
```{r results='markup'}

#removing missing values for BMI
cleanData$bmi[is.na(cleanData$bmi)] <- median(cleanData$bmi, na.rm = T) #replacing NA values with median of the remaining bmi values.
summary(cleanData)
```

Removing Outliers for BMI 
```{r results='markup'}

dim(cleanData)
quartiles_bmi <- quantile(cleanData$bmi, probs=c(.25, .75), na.rm = FALSE)
IQR_bmi <- IQR(cleanData$bmi)

 
Lower_bmi <- quartiles_bmi[1] - 1.5*IQR_bmi
Upper_bmi <- quartiles_bmi[2] + 1.5*IQR_bmi

#since all the missing values are for stroke =0 entries, we will directly drop it

cleanData <- subset(cleanData, cleanData$bmi > Lower_bmi & cleanData$bmi < Upper_bmi)

dim(cleanData)
```
```{r, results='markup'}

```


Removing Outliers for Average Glucose Level
```{r results='markup'}

dim(cleanData)
quartiles_glucose <- quantile(cleanData$avg_glucose_level, probs=c(.25, .75), na.rm = FALSE)
IQR_glucose <- IQR(cleanData$avg_glucose_level)

 
Lower_glucose <- quartiles_glucose[1] - 1.5*IQR_glucose
Upper_glucose <- quartiles_glucose[2] + 1.5*IQR_glucose

#since all the missing values are for stroke =0 entries, we will directly drop it

cleanData <- subset(cleanData, cleanData$avg_glucose_level > Lower_glucose & cleanData$avg_glucose_level < Upper_glucose)

dim(cleanData)

```

Let's check the distribution for numeric variables, bmi,age, avg_glucose_level : boxplot(outlier) and histogram(normal) => outliers **while doing avg_glucose_level and bmi => groupwise analysis as well**


```{r results='markup'}
```


```{r results='markup'}

table(cleanData$stroke)
#use SMOTE to create new dataset that is more balanced
cleanData <- SMOTE(stroke ~ ., cleanData, perc.over = 2000, perc.under = 200)
#minority => 2000/100 =20 so 20*(strok1Observations=416) #upsampling 
#200/100 =2, make the majority observation 2 time the minority observations #downsampling 

#view distribution of response variable in new dataset
table(cleanData$stroke)

```
```{r, results='markup'}

ggplot(data = cleanData, mapping = aes(x = stroke, y = bmi, fill=stroke)) +
  geom_boxplot()
```
With the boxplot above, subjects who have stroke has slightly lower BMI than subjects who did not have stroke. 

```{r, results='markup'}
ggplot(data = cleanData, mapping = aes(x = stroke, y = bmi, fill = stroke, color = gender)) +
  geom_boxplot() +
  labs(title = "Boxplot of BMI", 
       x = "Stroke", 
       y = "BMI") +
  scale_fill_brewer(palette = "Paired")
```
From the box plots above, there is no strong evidence of subjects having stroke with respect to BMI and gender.


```{r results='markup'}

```


3)do plots
4)show missing values for bmi and smoking_status
5)filling NA for bmi
6)removie for smoking_status 
7)remove outliers
8)smote
9)plot them again : qqplot => normality  
10) Comparison of age,bmi, avg_glucose_level to stroke
11) correlation plot for numeric variables

12) Plot correlation matrix for categorical variables 
13) analysis of residence_type and drop it 
14)Heart Disease: variable + age 

**Data Analysis for Heart Disease**

```{r results='markup'}
select_heart_disease <- select(cleanData, c('heart_disease','stroke'))
heart_effect <- select_heart_disease %>% group_by(heart_disease, stroke) %>% count(stroke)
ggplot(heart_effect, aes(heart_disease, n, fill = stroke)) + 
  geom_bar(stat = 'identity', position='fill') + 
  ggtitle("Distribution for heart disease on stroke")
ggplot(brainData, aes(heart_disease, age, color = stroke)) + 
  geom_boxplot() + 
  ggtitle("Distribution for age vs heart_disease on stroke")
```
 
* After cleaning the data, the plots above predicts that heart disease might actually have an impact on stroke but age has a bigger factor on stroke. We see that an increase in age comes with an increase in heart disease. This means that people in the higher age bracket are prone to heart diseases than people in the lower age bracket, this is the relation between heart disease and age.

15)Hypertension : variable +age

```{r, results='markup'}

df_hypertension_stroke <- data_no_outlier %>%
  group_by(hypertension, stroke) %>%
  count(stroke)

df_hypertension_stroke %>%
ggplot(mapping = aes(x = hypertension, y = n, fill = factor(stroke))) +
  geom_bar(stat = "identity", position = "fill") +
  labs(title = "Percentage of subjects with Hypertension vs. without Hypertension", 
       x = "Hypertension", 
       y = "Percentage") +
  scale_fill_brewer(palette = "Paired")

# df_count_hyptension_with_age <-
#   group_by(cleanData, age, hypertension) %>%
#   count(hypertension)
# 
# hypertension_positive = subset(df_count_hyptension_with_age, df_count_hyptension_with_age$hypertension==1)

# ggplot(hypertension_positive, mapping = aes(x=age, y=n)) + geom_point(alpha=0.5) + geom_smooth(method="loess",span=0.3)+
#   labs(title="Trend of number of hypertension cases with age", subtitle="Age distribution",x="Age",y="Number of subjects with hypertension")

ggplot(cleanData, aes(hypertension, age, color = stroke)) + 
  geom_boxplot() + 
  ggtitle("Distribution for age vs hypertension on stroke")

```


As we can see from the graph that the number of hypertension cases increases with the age due to multiple biological factors.
From the above charts, we see that the number of strokes is correlated to the hypertension status of the subject. But hypertension is in-turn correlated to age.


**Data Analysis for Ever Married**

```{r results='markup'}

ggplot(data = cleanData, mapping = aes(x = ever_married, y = age)) +
  geom_boxplot()

select_married <- select(cleanData, c('ever_married','stroke'))

married_effect <- 
  select_married %>% 
  group_by(ever_married, stroke) %>% 
  count(stroke)

ggplot(married_effect, aes(ever_married, n, fill = stroke)) + 
  geom_bar(stat = 'identity', position='fill') + 
  ggtitle("Distribution for Marriage Status on stroke")

ggplot(cleanData, aes(ever_married, age, color = stroke)) + 
  geom_boxplot() + 
  ggtitle("Distribution for age vs ever_married on stroke")
```

* From the plot above, we see that people who are married are more likely to get stroke but we then notice that age is a contributing factor to this hypothesis. The married people that get stroke are noticed in the older age bracket, which is why we say age is a major contributing factor to stroke.


17)Smoking Status

**Data Analysis for Smoking Status**

```{r results='markup'}
no_na_for_smoking_status <- subset(cleanData, !is.na(smoking_status))

ggplot(no_na_for_smoking_status, aes(smoking_status, age, color = stroke)) + 
  geom_boxplot() + 
  ggtitle("Distribution for age vs smoking_status on stroke")

select_smoke <- select(no_na_for_smoking_status, c('smoking_status','stroke'))

smoke_effect <- select_smoke %>% 
  group_by(smoking_status, stroke) %>% 
  count(stroke)

ggplot(smoke_effect, aes(smoking_status, n, fill = stroke)) + 
  geom_bar(stat = 'identity', position='fill') + 
  ggtitle("Distribution for smoking_status on stroke")
```
After the analysis of smoking status against stroke where `0` is `No` and `1` is `Yes`, we notice that smoking status does not really have an effect on stroke. According to the graph, we see that people who formerly smoked have more tendency to get strokes than people who never smoked and are still smoking. The boxplot distribution then shows that age is indeed has a great effect on stroke, we see that people approximately above 60 and formerly smoked have strokes under a normal distribution and younger people across all distribution do not have strokes.


18)Gender
19)WorkType
20)All the testing anova, chi-square
21)Conclusion : major factor, what all other factors it depends on, (logistic regression test)




